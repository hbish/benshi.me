---
import { Image } from 'astro:assets'
import profilePhoto from '../assets/profile-pic.png'
import { X, Github, Key, Mail, Linkedin, Menu } from '@lucide/astro'
import ThemeToggle from './ThemeToggle.astro'
---

<div class="sidebar text-center content-center">
  <!-- Mobile Navigation Backdrop -->
  <div
    id="mobile-nav-backdrop"
    class="lg:hidden hidden fixed inset-0 bg-black bg-opacity-50 z-[9997] transition-opacity duration-200"
  >
  </div>

  <!-- Mobile Navigation Toggle - Fixed Top Right -->
  <button
    id="mobile-nav-toggle"
    class="lg:hidden fixed top-4 right-4 z-[9999] w-10 h-10 bg-theme-secondary border border-theme rounded-lg text-theme hover:bg-theme transition-colors duration-200 flex items-center justify-center shadow-lg"
    aria-expanded="false"
    aria-controls="mobile-nav-menu"
    aria-label="Toggle navigation menu"
  >
    <Menu id="nav-icon" class="w-5 h-5 transition-transform duration-200" />
  </button>

  <div class="h-card">
    <div class="relative inline-block mx-auto">
      <a href="/" class="block">
        <Image
          class="w-20 h-20 lg:w-40 lg:h-40 rounded-full mx-auto profile-pic-border"
          src={profilePhoto}
          alt="Ben Shi - Software Engineer and Technologist from Sydney, Australia"
          widths={[80, 160, 320]}
          sizes="(max-width: 1024px) 80px, 160px"
          loading="eager"
          decoding="sync"
          format="webp"
          quality={90}
        />
      </a>
      <a
        href="/now/"
        class="absolute bottom-0 right-0 rounded-full text-xl lg:text-3xl hover:scale-110 transition-transform"
        aria-label="See what I'm doing now"
        title="What I'm doing now"
      >
        âœ¨
      </a>
    </div>
    <a href="/" class="p-name u-url text-center text-2xl lg:text-5xl">
      <h1 class="mx-auto my-1 lg:my-3">Ben Shi</h1>
    </a>
    <p class="p-note text-center hidden lg:block my-2">
      ðŸ‘‹ I'm a technologist from Sydney, Australia. I love solving complex problems.
    </p>
    <p class="p-note text-center hidden lg:block my-2">
      I write about software engineering, agile practices and self development & learning.
    </p>

    <!-- Navigation Menu -->
    <nav class="my-2">
      <!-- Mobile Navigation Menu (hidden by default) -->
      <div
        id="mobile-nav-menu"
        class="lg:hidden hidden flex-col space-y-3 py-4 px-4 border-t border-theme mt-4 fixed inset-x-4 top-16 bg-theme rounded-lg shadow-xl z-[9998]"
        role="navigation"
        aria-label="Main navigation"
      >
        <!-- Navigation Links -->
        <div class="space-y-2 mb-6">
          <a
            href="/about/"
            class="block px-4 py-3 text-center hover:bg-theme-secondary rounded-lg transition-colors duration-200 min-h-[44px] flex items-center justify-center"
          >
            /about
          </a>
          <a
            href="/work/"
            class="block px-4 py-3 text-center hover:bg-theme-secondary rounded-lg transition-colors duration-200 min-h-[44px] flex items-center justify-center"
          >
            /work
          </a>
          <a
            href="/photos/"
            class="block px-4 py-3 text-center hover:bg-theme-secondary rounded-lg transition-colors duration-200 min-h-[44px] flex items-center justify-center"
          >
            /photos
          </a>
          <a
            href="/uses/"
            class="block px-4 py-3 text-center hover:bg-theme-secondary rounded-lg transition-colors duration-200 min-h-[44px] flex items-center justify-center"
          >
            /uses
          </a>
        </div>

        <!-- Social Icons Section -->
        <div class="border-t border-theme pt-4 mb-4">
          <div class="text-xs uppercase tracking-wide text-theme-muted mb-3 text-center">
            Connect
          </div>
          <div class="flex gap-4 justify-center">
            <a
              href="https://x.com/hbish"
              title={'follow ben on x'}
              rel={'me'}
              class="min-h-[44px] min-w-[44px] flex items-center justify-center"
            >
              <X />
            </a>
            <a
              href="https://au.linkedin.com/in/benshi"
              title={'connect with ben on linkedin'}
              rel={'me'}
              class="min-h-[44px] min-w-[44px] flex items-center justify-center"
            >
              <Linkedin />
            </a>
            <a
              href="https://github.com/hbish"
              title={'follow ben on github'}
              rel={'me'}
              class="min-h-[44px] min-w-[44px] flex items-center justify-center"
            >
              <Github />
            </a>
            <a
              href="mailto:ben@hbish.com"
              title={'email ben'}
              rel={'me'}
              class={'u-email min-h-[44px] min-w-[44px] flex items-center justify-center'}
            >
              <Mail />
            </a>
            <a
              href="https://keybase.io/hbish"
              title={'auth me on keybase'}
              rel={'me'}
              class="min-h-[44px] min-w-[44px] flex items-center justify-center"
            >
              <Key />
            </a>
          </div>
        </div>

        <!-- Theme Toggle Section -->
        <div class="border-t border-theme pt-4">
          <div class="text-xs uppercase tracking-wide text-theme-muted mb-3 text-center">Theme</div>
          <div class="flex justify-center">
            <ThemeToggle />
          </div>
        </div>
      </div>

      <!-- Desktop Navigation (visible on lg and up) -->
      <div class="hidden lg:flex lg:flex-col items-center justify-start">
        <a href="/about/" class="block lg:inline-block lg:mt-0 mr-4 my-2"> /about </a>
        <a href="/work/" class="block lg:inline-block lg:mt-0 mr-4 my-2"> /work </a>
        <a href="/photos/" class="block lg:inline-block lg:mt-0 mr-4 my-2"> /photos </a>
        <a href="/uses/" class="block lg:inline-block lg:mt-0 mr-4 my-2"> /uses </a>
      </div>
    </nav>
    <!-- Social Icons - Desktop Only -->
    <div class="social hidden lg:flex gap-4 justify-center my-4">
      <a href="https://x.com/hbish" title={'follow ben on x'} rel={'me'}>
        <X />
      </a>
      <a href="https://au.linkedin.com/in/benshi" title={'connect with ben on linkedin'} rel={'me'}>
        <Linkedin />
      </a>
      <a href="https://github.com/hbish" title={'follow ben on github'} rel={'me'}>
        <Github />
      </a>
      <a href="mailto:ben@hbish.com" title={'email ben'} rel={'me'} class={'u-email'}>
        <Mail />
      </a>
      <a href="https://keybase.io/hbish" title={'auth me on keybase'} rel={'me'}>
        <Key />
      </a>
    </div>

    <!-- Theme Toggle - Desktop Only -->
    <div class="theme-section hidden lg:block my-4">
      <div class="text-xs uppercase tracking-wide text-theme-muted mb-2">theme</div>
      <ThemeToggle />
    </div>
  </div>
</div>

<script>
  // Mobile navigation toggle functionality
  function setupMobileNav() {
    const toggleButton = document.getElementById('mobile-nav-toggle')
    const mobileMenu = document.getElementById('mobile-nav-menu')
    const navIcon = document.getElementById('nav-icon')
    const backdrop = document.getElementById('mobile-nav-backdrop')

    if (!toggleButton || !mobileMenu || !navIcon || !backdrop) return

    toggleButton.addEventListener('click', () => {
      const isExpanded = toggleButton.getAttribute('aria-expanded') === 'true'

      // Toggle menu visibility
      mobileMenu.classList.toggle('hidden')
      backdrop.classList.toggle('hidden')

      // Update aria-expanded
      toggleButton.setAttribute('aria-expanded', String(!isExpanded))

      // Rotate icon
      if (isExpanded) {
        const menuIcon = document.createElementNS('http://www.w3.org/2000/svg', 'svg')
        menuIcon.setAttribute('class', 'w-5 h-5 transition-transform duration-200')
        menuIcon.setAttribute('fill', 'none')
        menuIcon.setAttribute('stroke', 'currentColor')
        menuIcon.setAttribute('viewBox', '0 0 24 24')
        menuIcon.innerHTML =
          '<line x1="4" y1="6" x2="20" y2="6" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"></line><line x1="4" y1="12" x2="20" y2="12" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"></line><line x1="4" y1="18" x2="20" y2="18" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"></line>'
        menuIcon.style.transform = 'rotate(0deg)'
        navIcon.replaceWith(menuIcon)
        menuIcon.id = 'nav-icon'
      } else {
        const xIcon = document.createElementNS('http://www.w3.org/2000/svg', 'svg')
        xIcon.setAttribute('class', 'w-5 h-5 transition-transform duration-200')
        xIcon.setAttribute('fill', 'none')
        xIcon.setAttribute('stroke', 'currentColor')
        xIcon.setAttribute('viewBox', '0 0 24 24')
        xIcon.innerHTML =
          '<line x1="18" y1="6" x2="6" y2="18" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"></line><line x1="6" y1="6" x2="18" y2="18" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"></line>'
        xIcon.style.transform = 'rotate(90deg)'
        navIcon.replaceWith(xIcon)
        xIcon.id = 'nav-icon'
      }
    })

    // Close mobile menu when clicking backdrop
    backdrop.addEventListener('click', () => {
      mobileMenu.classList.add('hidden')
      backdrop.classList.add('hidden')
      toggleButton.setAttribute('aria-expanded', 'false')
      const menuIcon = document.createElementNS('http://www.w3.org/2000/svg', 'svg')
      menuIcon.setAttribute('class', 'w-5 h-5 transition-transform duration-200')
      menuIcon.setAttribute('fill', 'none')
      menuIcon.setAttribute('stroke', 'currentColor')
      menuIcon.setAttribute('viewBox', '0 0 24 24')
      menuIcon.innerHTML =
        '<line x1="4" y1="6" x2="20" y2="6" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"></line><line x1="4" y1="12" x2="20" y2="12" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"></line><line x1="4" y1="18" x2="20" y2="18" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"></line>'
      menuIcon.style.transform = 'rotate(0deg)'
      navIcon.replaceWith(menuIcon)
      menuIcon.id = 'nav-icon'
    })

    // Close mobile menu when clicking navigation links
    const mobileNavLinks = mobileMenu.querySelectorAll('a')
    mobileNavLinks.forEach(link => {
      link.addEventListener('click', () => {
        mobileMenu.classList.add('hidden')
        backdrop.classList.add('hidden')
        toggleButton.setAttribute('aria-expanded', 'false')
        const menuIcon = document.createElementNS('http://www.w3.org/2000/svg', 'svg')
        menuIcon.setAttribute('class', 'w-5 h-5 transition-transform duration-200')
        menuIcon.setAttribute('fill', 'none')
        menuIcon.setAttribute('stroke', 'currentColor')
        menuIcon.setAttribute('viewBox', '0 0 24 24')
        menuIcon.innerHTML =
          '<line x1="4" y1="6" x2="20" y2="6" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"></line><line x1="4" y1="12" x2="20" y2="12" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"></line><line x1="4" y1="18" x2="20" y2="18" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"></line>'
        menuIcon.style.transform = 'rotate(0deg)'
        navIcon.replaceWith(menuIcon)
        menuIcon.id = 'nav-icon'
      })
    })

    // Close mobile menu on window resize to desktop size
    window.addEventListener('resize', () => {
      if (window.innerWidth >= 1024) {
        mobileMenu.classList.add('hidden')
        backdrop.classList.add('hidden')
        toggleButton.setAttribute('aria-expanded', 'false')
        const menuIcon = document.createElementNS('http://www.w3.org/2000/svg', 'svg')
        menuIcon.setAttribute('class', 'w-5 h-5 transition-transform duration-200')
        menuIcon.setAttribute('fill', 'none')
        menuIcon.setAttribute('stroke', 'currentColor')
        menuIcon.setAttribute('viewBox', '0 0 24 24')
        menuIcon.innerHTML =
          '<line x1="4" y1="6" x2="20" y2="6" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"></line><line x1="4" y1="12" x2="20" y2="12" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"></line><line x1="4" y1="18" x2="20" y2="18" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"></line>'
        menuIcon.style.transform = 'rotate(0deg)'
        navIcon.replaceWith(menuIcon)
        menuIcon.id = 'nav-icon'
      }
    })
  }

  // Initialize on page load
  setupMobileNav()

  // Reinitialize on Astro view transitions (if used)
  document.addEventListener('astro:page-load', setupMobileNav)
</script>
