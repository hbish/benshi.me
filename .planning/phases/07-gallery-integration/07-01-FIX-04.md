---
phase: 07-gallery-integration
plan: 01-FIX-04
type: execute
domain: astro
---

<objective>
Multiple fixes: add title to album detail, move tag pills to album index, fix active tag highlight, remove album index descriptions, add padding under album index title.

Purpose: Improve the gallery UX with better organization and filtering at the index level. Output:
Updated gallery pages with requested changes. </objective>

<execution_context> ~/.claude/get-shit-done/workflows/execute-phase.md ./summary.md
</execution_context>

<context>
@src/pages/photos.astro
@src/pages/photos/[slug].astro

**Current state:**

- Album index: Has title, 2-column grid, shows album descriptions
- Album detail: Has tag pills, no title, single column

**Desired state:**

- Album index: Has title + tag pills (moved from detail), no album descriptions, padding under title
- Album detail: Has title (restored), no tag pills (moved to index), single column

**Tag filtering logic for album index:**

- Aggregate all unique tags from ALL photos across ALL albums
- When a tag is selected, show only albums that contain photos with that tag
- Fix active tag highlighting bug (likely trailing slash issue)

**Issues being addressed:** Multiple UX improvements and bug fix </context>

<tasks>

<task type="auto">
  <name>Task 1: Update album index with tag filtering and remove descriptions</name>
  <files>src/pages/photos.astro</files>
  <action>Update the album index page with tag filtering and style improvements:

1. Add padding under the title: Change `my-2` to `my-6` on the section-title div

2. Remove album descriptions: Delete the `{collection.data.description && (...)}` block that shows
   `<p class="text-sm text-gray-600 mt-1">`

3. Add tag filtering logic:
   - Import getCollection for 'photos'
   - Get all photos and extract unique tags:
     `const allPhotos = await getCollection('photos'); const allTags = [...new Set(allPhotos.flatMap(photo => photo.data.tags || []))].sort()`
   - Get URL param for active tag:
     `const urlObj = new URL(Astro.request.url); const activeTag = urlObj.searchParams.get('tag')`
   - Filter collections: When activeTag is set, only show albums that have photos with that tag
   - For filtering: collections with photos matching the tag

4. Add tag pills navigation (moved from album detail):
   - Add the `<style>` block for .tag-pill classes (copy from album detail)
   - Add the tag pills nav after the title, before the grid
   - Use `/photos/?tag=${tag}` for tag links (no trailing slash to avoid current/active confusion)
   - Use `/photos/` for "All" link
   - Fix active highlighting: use `class:list` with proper comparison
   - Use `href={`/photos/${activeTag ? `?tag=${activeTag}` : ''}`}` pattern to avoid issues

5. Keep the 60% max-width container and 2-column grid

The tag filtering should work by checking if any photo in the album has the selected tag. </action>
<verify>Album index has tag pills, no descriptions, padding under title, active tag highlights
correctly</verify> <done>Album index updated with tag filtering and style improvements</done>
</task>

<task type="auto">
  <name>Task 2: Update album detail to restore title and remove tag pills</name>
  <files>src/pages/photos/[slug].astro</files>
  <action>Update the album detail page:

1. Add back the title section: Add
   `<div class="section-title text-center text-2xl my-2 px-4 sm:px-0">{collection.data.title}</div>`
   after Container open, before description

2. Remove the tag pills navigation: Delete the entire `{allTags.length > 0 && (<nav>...</nav>)}`
   block

3. Remove the activeTag URL param logic since we're no longer filtering on this page: Delete lines
   for urlObj and activeTag

4. Keep showing all photos (no filtering): Change `const photos = activeTag ? ...` to just use
   `collectionPhotos`

5. Keep the description, single column grid, 60% width, and "Back to Albums" link

The album detail becomes a simple view of all photos in an album without filtering. </action>
<verify>Album detail has title, no tag pills, all photos shown</verify> <done>Album detail updated
with title restored, tag pills removed</done> </task>

</tasks>

<verification>
Before declaring fix complete:
- [ ] `npm run build` succeeds without errors
- [ ] Album index has tag pills under title with padding
- [ ] Album index has no album descriptions
- [ ] Album index filters albums by tag correctly
- [ ] Active tag pill highlights correctly
- [ ] Album detail has title
- [ ] Album detail has no tag pills
</verification>

<success_criteria>

- Album index: Tag filtering for albums, no descriptions, padding under title
- Album detail: Title restored, no tag pills, simple photo grid
- Active tag highlighting works correctly </success_criteria>

<output>
After completion, create `.planning/phases/07-gallery-integration/07-01-FIX-04-SUMMARY.md`:

# Phase 7 Fix 04: Multiple UX Improvements Summary

**Tag filtering moved to album index, title restored to album detail, descriptions removed, active
tag fixed.**

## Accomplishments

- Album index: Added tag filtering for all albums
- Album index: Removed album descriptions
- Album index: Added padding under title
- Album detail: Restored title section
- Album detail: Removed tag pills
- Fixed active tag highlighting bug

## Files Created/Modified

- `src/pages/photos.astro` - Tag filtering, no descriptions, padding
- `src/pages/photos/[slug].astro` - Title restored, tag pills removed

## Decisions Made

- Tag filtering at index level (shows albums with matching photos)
- Trailing slash handling for active tag fix

## Issues Encountered

None

---

</output>
